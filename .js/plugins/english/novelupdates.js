"use strict";var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(r,n){function o(e){try{u(l.next(e))}catch(e){n(e)}}function s(e){try{u(l.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}u((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(u){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(o=0)),o;)try{if(a=1,l&&(r=2&s[0]?l.return:s[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,s[1])).done)return r;switch(l=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:0};case 5:o.label++,l=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],l=0}finally{a=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:1});var a=require("cheerio"),l=require("@libs/fetch"),r=require("@libs/filterInputs"),n=function(){function n(){this.id="novelupdates",this.name="Novel Updates",this.version="0.5.2",this.icon="src/en/novelupdates/icon.png",this.site="https://www.novelupdates.com/",this.filters={sort:{label:"Sort Results By",value:"sdate",options:[{label:"Last Updated",value:"sdate"},{label:"Rating",value:"srate"},{label:"Rank",value:"srank"},{label:"Reviews",value:"sreview"},{label:"Chapters",value:"srel"},{label:"Title",value:"abc"},{label:"Readers",value:"sread"},{label:"Frequency",value:"sfrel"}],type:r.FilterTypes.Picker},order:{label:"Order",value:"desc",options:[{label:"Descending",value:"desc"},{label:"Ascending",value:"asc"}],type:r.FilterTypes.Picker},storyStatus:{label:"Story Status (Translation)",value:"",options:[{label:"All",value:""},{label:"Completed",value:"2"},{label:"Ongoing",value:"3"},{label:"Hiatus",value:"4"}],type:r.FilterTypes.Picker},language:{label:"Language",value:[],options:[{label:"Chinese",value:"495"},{label:"Filipino",value:"9181"},{label:"Indonesian",value:"9179"},{label:"Japanese",value:"496"},{label:"Khmer",value:"18657"},{label:"Korean",value:"497"},{label:"Malaysian",value:"9183"},{label:"Thai",value:"9954"},{label:"Vietnamese",value:"9177"}],type:r.FilterTypes.CheckboxGroup},novelType:{label:"Novel Type",value:[],options:[{label:"Light Novel",value:"2443"},{label:"Published Novel",value:"26874"},{label:"Web Novel",value:"2444"}],type:r.FilterTypes.CheckboxGroup},genres:{label:"Genres",type:r.FilterTypes.ExcludableCheckboxGroup,value:{include:[],exclude:[]},options:[{label:"Action",value:"8"},{label:"Adult",value:"280"},{label:"Adventure",value:"13"},{label:"Comedy",value:"17"},{label:"Drama",value:"9"},{label:"Ecchi",value:"292"},{label:"Fantasy",value:"5"},{label:"Gender Bender",value:"168"},{label:"Harem",value:"3"},{label:"Historical",value:"330"},{label:"Horror",value:"343"},{label:"Josei",value:"324"},{label:"Martial Arts",value:"14"},{label:"Mature",value:"4"},{label:"Mecha",value:"10"},{label:"Mystery",value:"245"},{label:"Psychoical",value:"486"},{label:"Romance",value:"15"},{label:"School Life",value:"6"},{label:"Sci-fi",value:"11"},{label:"Seinen",value:"18"},{label:"Shoujo",value:"157"},{label:"Shoujo Ai",value:"851"},{label:"Shounen",value:"12"},{label:"Shounen Ai",value:"1692"},{label:"Slice of Life",value:"7"},{label:"Smut",value:"281"},{label:"Sports",value:"1357"},{label:"Supernatural",value:"16"},{label:"Tragedy",value:"132"},{label:"Wuxia",value:"479"},{label:"Xianxia",value:"480"},{label:"Xuanhuan",value:"3954"},{label:"Yaoi",value:"560"},{label:"Yuri",value:"922"}]},genre_operator:{label:"Genre (AND/OR)",value:"and",options:[{label:"AND",value:"and"},{label:"OR",value:"or"}],type:r.FilterTypes.Picker}}}return n.prototype.parseNovels=function(e){var t=this,a=[];return e("div.search_main_box_nu").each((function(l,r){var n=e(r).find("img").attr("src"),o=e(r).find(".search_title > a").text(),s=e(r).find(".search_title > a").attr("href");if(s){var u={name:o,cover:n,path:s.replace(t.site,"")};a.push(u)}})),a},n.prototype.popularNovels=function(r,n){var o,s,u,i,c,v,h=n.showLatestNovels,p=n.filters;return e(this,void 0,void 0,(function(){var e,n,d;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site),p.language.value.length||p.novelType.value.length||(null===(o=p.genres.value.include)||void 0===o?void 0:o.length)||(null===(s=p.genres.value.exclude)||void 0===s?void 0:s.length)||""!==p.storyStatus.value?e+="series-finder/?sf=1":e+=h?"latest-series/?st=1":"series-ranking/?rank=week",p.language.value.length&&(e+="&org="+p.language.value.join(",")),p.novelType.value.length&&(e+="&nt="+p.novelType.value.join(",")),(null===(u=p.genres.value.include)||void 0===u?void 0:u.length)&&(e+="&gi="+p.genres.value.include.join(",")),(null===(i=p.genres.value.exclude)||void 0===i?void 0:i.length)&&(e+="&ge="+p.genres.value.exclude.join(",")),((null===(c=p.genres.value.include)||void 0===c?void 0:c.length)||(null===(v=p.genres.value.exclude)||void 0===v?void 0:v.length))&&(e+="&mgi="+p.genre_operator.value),p.storyStatus.value.length&&(e+="&ss="+p.storyStatus.value),e+="&sort="+p.sort.value,e+="&order="+p.order.value,e+="&pg="+r,[4,(0,l.fetchApi)(e).then((function(e){return e.text()}))];case 1:return n=t.sent(),d=(0,a.load)(n),[2,this.parseNovels(d)]}}))}))},n.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,n,o,s,u,i,c,v,h,p,d,b=this;return t(this,(function(t){switch(t.label){case 0:return e=this.site+r,[4,(0,l.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return n=t.sent(),o=(0,a.load)(n),(s={path:r,name:o(".seriestitlenu").text()||"Untitled",cover:o(".wpb_wrapper img").attr("src"),chapters:[]}).author=o("#authtag").map((function(e,t){return o(t).text().trim()})).toArray().join(", "),s.genres=o("#seriesgenre").children("a").map((function(e,t){return o(t).text()})).toArray().join(","),s.status=o("#editstatus").text().includes("Ongoing")?"Ongoing":"Completed",u=o("#showtype").text().trim(),i=o("#editdescription").text().trim(),s.summary=i+"\n\nType: ".concat(u),c=[],v=o("input#mypostid").attr("value"),(h=new FormData).append("action","nd_getchapters"),h.append("mygrr","0"),h.append("mypostid",v),p="".concat(this.site,"wp-admin/admin-ajax.php"),[4,(0,l.fetchApi)(p,{method:"POST",body:h}).then((function(e){return e.text()}))];case 3:return d=t.sent(),(o=(0,a.load)(d))("li.sp_li_chp").each((function(e,t){var a=o(t).text().trim(),l="https:"+o(t).find("a").first().next().attr("href");c.push({name:a,path:l.replace(b.site,"")})})),s.chapters=c.reverse(),[2,s]}}))}))},n.prototype.getLocation=function(e){var t=e.match(/^(https?:)\/\/(([^:/?#]*)(?::([0-9]+))?)([/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return t&&"".concat(t[1],"//").concat(t[3])},n.prototype.parseChapter=function(r){var n;return e(this,void 0,void 0,(function(){var e,o,s,u,i,c,v,h,p,d,b,f,m,g,y,w,x,C,L,T,S,_,k,A;return t(this,(function(t){switch(t.label){case 0:return e="",[4,(0,l.fetchApi)(this.site+r)];case 1:return[4,(o=t.sent()).text()];case 2:return s=t.sent(),u=(0,a.load)(s),i=o.url.toLowerCase().includes("wuxiaworld"),c=o.url.toLowerCase().includes("blogspot"),v=o.url.toLowerCase().includes("tumblr"),h=o.url.toLowerCase().includes("wattpad"),p=o.url.toLowerCase().includes("anotivereads"),d=o.url.toLowerCase().includes("ko-fi"),b=o.url.toLowerCase().includes("blossomtranslation"),f=o.url.toLowerCase().includes("lightnovelstranslations"),m=o.url.toLowerCase().includes("inoveltranslation"),g=o.url.toLowerCase().includes("travistranslations"),y=o.url.toLowerCase().includes("raeitranslations"),w=u('meta[name="generator"]').attr("content")||u("footer").text(),x=0,w&&(x=w.toLowerCase().includes("wordpress")||w.includes("Site Kit by Google")||u(".powered-by").text().toLowerCase().includes("wordpress")),C=o.url.toLowerCase().includes("rainofsnow"),L=o.url.toLowerCase().includes("webnovel"),T=o.url.toLowerCase().includes("hostednovel"),S=o.url.toLowerCase().includes("scribblehub"),i?(e=u("#chapter-content").html(),[3,19]):[3,3];case 3:return C?(e=u("div.content").html(),[3,19]):[3,4];case 4:return v?(e=u(".post").html(),[3,19]):[3,5];case 5:return c?(u(".post-share-buttons").remove(),e=u(".entry-content").html()||u("#post-body").html(),[3,19]):[3,6];case 6:return T?(e=u(".chapter").html(),[3,19]):[3,7];case 7:return S?(e=u("div.chp_raw").html(),[3,19]):[3,8];case 8:return h?(e=u(".container  pre").html(),[3,19]):[3,9];case 9:return g?(e=u(".reader-content").html(),[3,19]):[3,10];case 10:return f?(e=u(".text_story").html(),[3,19]):[3,11];case 11:return b?(e=u(".manga-child-content").html(),[3,19]):[3,12];case 12:return p?(e=u("#comic").html(),[3,19]):[3,13];case 13:return y?(_=o.url.split("/"),k="".concat(_[0],"//api.").concat(_[2],"/api/chapters/?id=").concat(_[3],"&num=").concat(_[4]),[4,(0,l.fetchApi)(k).then((function(e){return e.json()}))]):[3,15];case 14:return A=t.sent(),e=(e=A.currentChapter.head+"<br><hr><br>"+A.currentChapter.body+"<br><hr><br>Translator's Note:<br>"+A.currentChapter.note).replace(/\n/g,"<br>"),[3,19];case 15:return d?(e=null===(n=u('script:contains("shadowDom.innerHTML")').html())||void 0===n?void 0:n.match(/shadowDom\.innerHTML \+= '(<div.*?)';/)[1],[3,19]):[3,16];case 16:return m?(k="https://api."+o.url.slice(8),[4,(0,l.fetchApi)(k).then((function(e){return e.json()}))]):[3,18];case 17:return A=t.sent(),e=A.content.replace(/\n/g,"<br>"),A.notes&&(e+="<br><hr><br>TL Notes:<br>"+A.notes.replace(/\n/g,"<br>")),[3,19];case 18:x?([".c-ads","#madara-comments","#comments",".content-comments",".sharedaddy",".wp-dark-mode-switcher",".wp-next-post-navi",".wp-block-buttons",".wp-block-columns",".post-cats",".sidebar",".author-avatar",".ezoic-ad"].map((function(e){return u(e).remove()})),e=u(".entry-content").html()||u(".single_post").html()||u(".post-entry").html()||u(".main-content").html()||u("article.post").html()||u(".content").html()||u("#content").html()||u(".page-body").html()||u(".td-page-content").html()):L?(e=u(".cha-words").html())||(e=u("._content").html()):(["nav","header","footer",".hidden"].map((function(e){return u(e).remove()})),e=u("body").html()),t.label=19;case 19:return e&&(e=e.replace(/href="\//g,'href="'.concat(this.getLocation(o.url),"/"))),[2,e]}}))}))},n.prototype.searchNovels=function(r,n){return e(this,void 0,void 0,(function(){var e,n,o;return t(this,(function(t){switch(t.label){case 0:return e=this.site+"?s="+r.replace(/\s+/g,"+")+"&post_type=seriesplans",[4,(0,l.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return n=t.sent(),o=(0,a.load)(n),[2,this.parseNovels(o)]}}))}))},n.prototype.fetchImage=function(e){return(0,l.fetchFile)(e)},n}();exports.default=new n;